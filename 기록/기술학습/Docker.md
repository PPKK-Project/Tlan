## 📝 도커파일(Dockerfile) 작성 가이드

도커파일은 도커 이미지를 빌드하기 위한 명령어들을 순차적으로 나열해 놓은 **텍스트 파일**입니다. 이 파일은 컨테이너화할 애플리케이션의 **운영 환경을 정의**합니다.

-----

## 1\. 도커파일의 기본 구조 및 빌드 과정

도커 이미지는 도커파일에 정의된 각 명령어(**Instruction**)가 실행되어 생성되는 **'레이어(Layer)'** 들의 집합입니다.

### 💡 레이어(Layer)의 중요성

  * **재사용성**: 한 번 빌드된 레이어는 **캐시**되어 다음 빌드 시 변경 사항이 없으면 재사용됩니다.
  * **용량 효율**: 여러 이미지가 같은 레이어를 **공유**할 수 있어 디스크 공간을 절약합니다.
  * **빌드 속도**: 캐시를 활용하여 빌드 속도를 높입니다.

-----

## 2\. 도커파일의 필수 명령어

| 명령어 | 역할 | 설명 |
| :--- | :--- | :--- |
| **FROM** | 베이스 이미지 설정 | 모든 도커파일의 **첫 번째 명령어**입니다. 이미지 빌드를 시작할 기본 환경(OS, 런타임 등)을 지정합니다. |
| **RUN** | 빌드 시 명령 실행 | 이미지 빌드 과정에서 필요한 명령(예: 패키지 설치, 파일 다운로드)을 실행하고 그 결과를 새로운 **레이어로 저장**합니다. |
| **CMD** | 컨테이너 실행 명령 | 컨테이너가 시작될 때 **기본적으로 실행될 명령**을 지정합니다. 도커파일당 하나만 사용 가능하며, `docker run` 명령으로 덮어쓸 수 있습니다. |
| **ENTRYPOINT** | 컨테이너 실행 명령 | 컨테이너가 시작될 때 **항상 실행될 명령**을 지정합니다. `docker run`으로 덮어쓸 수 없으며, **CMD와 함께 사용**되어 실행될 인수(Arguments)를 설정하는 데 주로 쓰입니다. |

### 예시: CMD와 ENTRYPOINT의 차이

| 사용법 | `docker run <image>` 실행 시 결과 |
| :--- | :--- |
| `CMD ["echo", "Hello"]` | `Hello` 출력 |
| `CMD ["echo", "World"]` + `docker run <image> Korea` | `Korea` 출력 (CMD가 덮어쓰임) |
| `ENTRYPOINT ["echo"]` `CMD ["Hello"]` | `Hello` 출력 (CMD는 인수로 사용됨) |
| `ENTRYPOINT ["echo"]` `CMD ["Hello"]` + `docker run <image> World` | `World` 출력 (CMD만 덮어쓰고 ENTRYPOINT는 유지됨) |

-----

## 3\. 파일 및 환경 설정 명령어

| 명령어 | 역할 | 설명 |
| :--- | :--- | :--- |
| **COPY** | 파일 복사 | **호스트 머신**의 파일/디렉토리를 **이미지 내부**로 복사합니다. 가장 흔하게 사용됩니다. |
| **ADD** | 파일 복사 (고급) | `COPY`와 비슷하지만, tar 아카이브를 자동으로 압축 해제하거나 원격 URL에서 파일을 가져올 수 있는 추가 기능이 있습니다. **보안/캐싱 문제로 보통 COPY를 권장합니다.** |
| **WORKDIR** | 작업 디렉토리 설정 | `RUN`, `CMD`, `ENTRYPOINT`, `COPY`, `ADD`와 같은 명령어들이 실행될 이미지 내의 **작업 디렉토리를 지정**합니다. |
| **ENV** | 환경 변수 설정 | 이미지 내부에서 사용할 **영구적인 환경 변수**를 설정합니다. |
| **ARG** | 빌드 시 변수 설정 | **빌드 시간(Build Time)**에만 사용되는 변수를 정의합니다. 컨테이너 내부에서는 사용할 수 없습니다. `docker build --build-arg key=value`로 값을 전달합니다. |
| **EXPOSE** | 포트 노출 | 컨테이너가 수신 대기하는 포트(**Port**)를 **문서화**합니다. 실제로 포트를 외부와 연결하려면 `docker run -p` 옵션이 필요합니다. |

-----

## 4\. 실전 예제: Node.js 애플리케이션 도커파일

다음은 간단한 Node.js 기반의 웹 애플리케이션을 컨테이너화하는 효율적인 도커파일 예시입니다.

### 파일 구조

```
/project
  ├── Dockerfile
  ├── package.json
  ├── package-lock.json
  └── server.js
```

### 📄 Dockerfile 내용

```dockerfile
# 1. Base Image 설정
FROM node:18-alpine

# 2. 작업 디렉토리 설정
WORKDIR /usr/src/app

# 3. 종속성 파일 복사 및 설치
# 캐시를 효율적으로 사용하기 위해 자주 바뀌지 않는 파일을 먼저 복사합니다.
COPY package*.json ./

# 4. 종속성 설치 (새로운 레이어)
RUN npm install --production

# 5. 나머지 애플리케이션 파일 복사
COPY . .

# 6. 애플리케이션 포트 노출 (문서화용)
EXPOSE 3000

# 7. 컨테이너 실행 명령 정의
# ENTRYPOINT와 CMD를 함께 사용하여 실행 인수를 분리합니다.
CMD [ "npm", "start" ]
```

-----